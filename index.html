<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linz Spielt - Spieleausleihe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; } /* gray-800 */
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; } /* gray-600 */
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; } /* gray-500 */
        /* Custom Dropdown Arrow */
        select {
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%239CA3AF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.4-5.4-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 0.65em auto;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-bold text-white">Linz Spielt</h1>
            <p class="text-lg text-blue-400">Spieleausleihe</p>
        </header>

        <!-- Filterleiste -->
        <div class="bg-gray-800 p-4 rounded-lg mb-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 sticky top-4 z-10 shadow-lg border border-gray-700">
            <div class="lg:col-span-2">
                <input type="text" id="search-input" placeholder="Spiel suchen..." class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <select id="category-filter" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none">
                    <option value="all">Alle Kategorien</option>
                </select>
            </div>
            <div>
                <select id="players-filter" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none">
                    <option value="0">Jede Spielerzahl</option>
                    <option value="1">1 Spieler</option>
                    <option value="2">2 Spieler</option>
                    <option value="3">3 Spieler</option>
                    <option value="4">4 Spieler</option>
                    <option value="5">5 Spieler</option>
                    <option value="6">6 Spieler</option>
                    <option value="7">7+ Spieler</option>
                </select>
            </div>
            <div>
                <select id="duration-filter" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none">
                    <option value="0">Alle Spielzeiten</option>
                    <option value="30">max. 30 Min.</option>
                    <option value="60">max. 60 Min.</option>
                    <option value="90">max. 90 Min.</option>
                    <option value="120">max. 120 Min.</option>
                </select>
            </div>
        </div>

        <!-- Spieletabelle -->
        <div class="overflow-x-auto bg-gray-800 rounded-lg shadow-lg border border-gray-700">
            <table class="w-full min-w-max">
                <thead class="bg-gray-700/50">
                    <tr>
                        <th class="p-4 text-left text-sm font-semibold text-gray-300 uppercase tracking-wider">Spielname</th>
                        <th class="p-4 text-center text-sm font-semibold text-gray-300 uppercase tracking-wider hidden sm:table-cell">Regal</th>
                        <th class="p-4 text-center text-sm font-semibold text-gray-300 uppercase tracking-wider hidden md:table-cell">Spieler</th>
                        <th class="p-4 text-center text-sm font-semibold text-gray-300 uppercase tracking-wider hidden sm:table-cell">Dauer</th>
                        <th class="p-4 text-center text-sm font-semibold text-gray-300 uppercase tracking-wider">Status</th>
                        <th class="p-4 text-center text-sm font-semibold text-gray-300 uppercase tracking-wider">Aktion</th>
                    </tr>
                </thead>
                <tbody id="game-table-body" class="divide-y divide-gray-700">
                    <!-- Spiel-Eintr채ge werden hier per JavaScript eingef체gt -->
                </tbody>
            </table>
            <div id="no-results" class="hidden text-center p-8 text-gray-400">
                <p class="text-xl">Keine Spiele gefunden.</p>
            </div>
        </div>
    </div>

    <script>
        // Spieledatenbank
        const gamesData = [
            { id: 1, title: "SkyTeam", shelf: 5, categories: ["Kooperatives Spiel", "Strategiespiel"], playerCount: "2", minPlayers: 2, maxPlayers: 2, duration: "20 min", maxDuration: 20, age: "12+", isLent: false },
            { id: 2, title: "Karak", shelf: 12, categories: ["Thematisches Spiel", "Familienspiel"], playerCount: "2-5", minPlayers: 2, maxPlayers: 5, duration: "45 min", maxDuration: 45, age: "7+", isLent: false },
            { id: 3, title: "Dixit", shelf: 18, categories: ["Partyspiel"], playerCount: "3-8", minPlayers: 3, maxPlayers: 8, duration: "30 min", maxDuration: 30, age: "8+", isLent: false },
            { id: 4, title: "Dune Imperium: Uprising", shelf: 3, categories: ["Thematisches Spiel", "Strategiespiel"], playerCount: "1-4", minPlayers: 1, maxPlayers: 4, duration: "60-120 min", maxDuration: 120, age: "14+", isLent: false },
            { id: 5, title: "Arche Nova", shelf: 7, categories: ["Strategiespiel"], playerCount: "1-4", minPlayers: 1, maxPlayers: 4, duration: "90-150 min", maxDuration: 150, age: "14+", isLent: false }
        ];
        gamesData.sort((a, b) => a.title.localeCompare(b.title));

        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('search-input');
            const categoryFilter = document.getElementById('category-filter');
            const playersFilter = document.getElementById('players-filter');
            const durationFilter = document.getElementById('duration-filter');
            const tableBody = document.getElementById('game-table-body');
            const noResultsDiv = document.getElementById('no-results');

            // --- Cookie-Funktionen ---
            const saveStateToCookie = () => {
                const lentGameIds = gamesData.filter(game => game.isLent).map(game => game.id);
                const expires = new Date(Date.now() + 2 * 864e5).toUTCString();
                document.cookie = `lentGamesLinz=${JSON.stringify(lentGameIds)}; expires=${expires}; path=/; SameSite=Lax`;
            };
            const loadStateFromCookie = () => {
                const cookieString = document.cookie.split('; ').find(row => row.startsWith('lentGamesLinz='));
                if (cookieString) {
                    try {
                        const lentGameIds = JSON.parse(cookieString.split('=')[1]);
                        if (Array.isArray(lentGameIds)) {
                            gamesData.forEach(game => {
                                if (lentGameIds.includes(game.id)) game.isLent = true;
                            });
                        }
                    } catch (e) { console.error("Cookie-Fehler:", e); }
                }
            };

            const populateCategories = () => {
                const categories = [...new Set(gamesData.flatMap(game => game.categories))];
                categories.sort();
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categoryFilter.appendChild(option);
                });
            };

            const renderTable = (filteredGames) => {
                tableBody.innerHTML = '';
                noResultsDiv.classList.toggle('hidden', filteredGames.length > 0);

                filteredGames.forEach(game => {
                    const row = document.createElement('tr');
                    row.className = `transition-colors duration-200 ${game.isLent ? 'opacity-50' : 'hover:bg-gray-700/50'}`;
                    row.dataset.gameId = game.id;

                    const lentStatusText = game.isLent ? 'Ausgeliehen' : 'Verf체gbar';
                    const lentStatusClasses = game.isLent ? 'text-red-400' : 'text-green-400';
                    const buttonText = game.isLent ? 'Zur체ckgeben' : 'Ausleihen';
                    const buttonClasses = game.isLent ? 'bg-yellow-600 hover:bg-yellow-500' : 'bg-blue-600 hover:bg-blue-500';

                    row.innerHTML = `
                        <td class="p-4 font-medium text-white">${game.title}</td>
                        <td class="p-4 text-center text-gray-300 hidden sm:table-cell font-semibold text-lg">${game.shelf}</td>
                        <td class="p-4 text-center text-gray-300 hidden md:table-cell">${game.playerCount}</td>
                        <td class="p-4 text-center text-gray-300 hidden sm:table-cell">${game.duration}</td>
                        <td class="p-4 text-center font-semibold ${lentStatusClasses}">${lentStatusText}</td>
                        <td class="p-4 text-center">
                            <button class="status-button w-full sm:w-auto text-white font-semibold py-2 px-4 rounded-md transition-colors text-sm ${buttonClasses}">
                                ${buttonText}
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            };

            const toggleLentStatus = (gameId) => {
                const game = gamesData.find(g => g.id === gameId);
                if (game) {
                    game.isLent = !game.isLent;
                    saveStateToCookie();
                    filterAndRender();
                }
            };

            const filterAndRender = () => {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedCategory = categoryFilter.value;
                const selectedPlayers = parseInt(playersFilter.value, 10);
                const selectedDuration = parseInt(durationFilter.value, 10);

                const filteredGames = gamesData.filter(game => {
                    const nameMatch = game.title.toLowerCase().includes(searchTerm);
                    const categoryMatch = selectedCategory === 'all' || game.categories.includes(selectedCategory);
                    
                    let playersMatch = true;
                    if (selectedPlayers > 0) {
                        if (selectedPlayers < 7) {
                            playersMatch = game.minPlayers <= selectedPlayers && game.maxPlayers >= selectedPlayers;
                        } else {
                            playersMatch = game.maxPlayers >= 7;
                        }
                    }
                    
                    const durationMatch = selectedDuration === 0 || game.maxDuration <= selectedDuration;
                    
                    return nameMatch && categoryMatch && playersMatch && durationMatch;
                });
                renderTable(filteredGames);
            };

            // Event Listeners
            [searchInput, categoryFilter, playersFilter, durationFilter].forEach(el => {
                el.addEventListener('input', filterAndRender);
                el.addEventListener('change', filterAndRender);
            });

            tableBody.addEventListener('click', (event) => {
                if (event.target.classList.contains('status-button')) {
                    const gameRow = event.target.closest('tr');
                    const gameId = parseInt(gameRow.dataset.gameId, 10);
                    toggleLentStatus(gameId);
                }
            });

            // Initialisierung
            loadStateFromCookie();
            populateCategories();
            filterAndRender();
        });
    </script>
</body>
</html>
